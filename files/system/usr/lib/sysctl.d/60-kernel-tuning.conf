# --- 1. MEMORY & SWAP OPTIMIZATIONS (ZRAM/SSD) ---
# Disable read-ahead for swap (better for ZRAM/fast SSDs)
vm.page-cluster = 0

# Aggressive adjustments to avoid STALLS during memory pressure
vm.watermark_boost_factor = 0
vm.watermark_scale_factor = 125

# Write to disk more frequently to avoid massive I/O spikes
# Optimized for 64GB RAM: Fixed byte limits instead of ratios to prevent multi-GB stalls
vm.dirty_bytes = 536870912            # 512MB
vm.dirty_background_bytes = 268435456 # 256MB

# Preference for retaining file structure cache (dentry/inode) in RAM
vm.vfs_cache_pressure = 50

# --- 2. NETWORK PERFORMANCE (BBR & TCP) ---
# Google BBR congestion control algorithm (Better throughput/latency)
net.core.default_qdisc = fq
net.ipv4.tcp_congestion_control = bbr

# Enable TCP Fast Open (Reduces handshake latency)
net.ipv4.tcp_fastopen = 3

# --- 3. SECURITY & PRIVACY ---
# Restrict ptrace scope (Mitigates code injection attacks)
kernel.yama.ptrace_scope = 1

# IPv6 Privacy Extensions (Temporary addresses to hinder tracking)
net.ipv6.conf.all.use_tempaddr = 2
net.ipv6.conf.default.use_tempaddr = 2

# Ignore router redirections (MITM attack mitigation)
net.ipv6.conf.all.accept_ra = 1
net.ipv6.conf.default.accept_ra = 1

# Basic protection against SYN Flood and spoofing
net.ipv4.tcp_syncookies = 1
net.ipv4.tcp_rfc1337 = 1

# --- 4. SYSTEM LIMITS (Gaming & IDEs) ---
# Increase open file limit (Crucial for Wine/Proton and heavy Flatpaks)
fs.file-max = 2097152

# Increase Inotify limits (Essential for VSCode, IntelliJ, Syncthing)
fs.inotify.max_user_instances = 512
fs.inotify.max_user_watches = 524288

# --- 5. ADVANCED NETWORK OPTIMIZATION (High-Bandwidth) ---
# Increase backlog for simultaneous connections (P2P/Servers)
net.core.netdev_max_backlog = 16384
net.core.somaxconn = 8192

# Increase TCP read/write buffers (Ideal for Gigabit/Wifi 6+ networks)
net.core.rmem_max = 16777216
net.core.wmem_max = 16777216
net.ipv4.tcp_rmem = 4096 87380 16777216
net.ipv4.tcp_wmem = 4096 16384 16777216

# --- ZRAM OPTIMIZATION ---
# For desktops with plenty of RAM, keeping a moderate value reduces premature swap
# without losing ZRAM benefits under load.
vm.swappiness = 90

# High limit for games/loads with many memory regions, but not extreme.
vm.max_map_count = 1048576